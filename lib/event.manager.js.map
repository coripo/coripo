{"version":3,"sources":["../src/event.manager.js"],"names":["GregorianAdapter","require","Event","OneDate","BasicGenerator","Generator","EventManager","config","primaryAdapterId","primaryAdapter","adapters","generators","eventStore","getAdaptersInfo","map","id","a","name","description","getGeneratorsInfo","g","inputs","getAdapter","adapterId","adapter","find","Error","generateDate","dateConfig","helper","getCurrentDate","date","l10n","year","Date","getFullYear","month","getMonth","day","getDate","getMonthInfo","getMonthName","days","getMonthLength","getGenerator","generatorId","generator","construct","locale","concat","plugins","Adapter","dependencies","addEvent","eventConfig","event","generate","removeEvent","eventId","filter","evt","editEvent","handleOverlaps","seriesArray","_since","_till","reduce","sArray","series","overlap","external","includes","conflicts","s","sameGenerator","sameOverlapRule","sort","b","range","since","int","length","master","items","forever","rangeSince","rangeTill","offsetYear","till","slaves","slice","sa","item","events","e","collides","slaveEvents","evts","trimmedSlaves","slave","collision","virtual","repeated","priority","title","note","color","offsetDay","query","getEventsIn","acc","exports"],"mappings":"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","file":"event.manager.js","sourcesContent":["const GregorianAdapter = require('coripo-core').GregorianAdapter;\nconst Event = require('coripo-core').Event;\nconst OneDate = require('coripo-core').OneDate;\nconst BasicGenerator = require('./basic.generator.js').Generator;\n\nconst EventManager = function EventManager(config = {}) {\n  let primaryAdapterId;\n  let primaryAdapter;\n  let adapters = [];\n  let generators = [];\n  let eventStore = [];\n\n  const getAdaptersInfo = () => adapters.map(a => (\n    { id: a.id, name: a.name, description: a.description }\n  ));\n\n  const getGeneratorsInfo = () => generators.map(g => (\n    { id: g.id, name: g.name, description: g.description, inputs: g.inputs }\n  ));\n\n  const getAdapter = (adapterId) => {\n    const adapter = adapters.find(a => a.id === (adapterId || primaryAdapterId));\n    if (!adapter) throw new Error(`requested adapter '${adapterId}' not found.`);\n    return adapter;\n  };\n\n  const generateDate = (dateConfig) => {\n    const helper = { getAdapter, primaryAdapterId };\n    return new OneDate(dateConfig, helper);\n  };\n\n  const getCurrentDate = () => {\n    const date = primaryAdapter.l10n({\n      year: new Date().getFullYear(),\n      month: new Date().getMonth() + 1,\n      day: new Date().getDate(),\n    });\n    return generateDate(date);\n  };\n\n  const getMonthInfo = (year, month) => ({\n    name: primaryAdapter.getMonthName(month),\n    days: primaryAdapter.getMonthLength(year, month),\n  });\n\n  const getGenerator = (generatorId) => {\n    const generator = generators.find(g => g.id === generatorId);\n    if (!generator) throw new Error(`requested generator '${generatorId}' not found.`);\n    return generator;\n  };\n\n  const construct = () => {\n    const locale = config.locale || 'en';\n    adapters = ([GregorianAdapter]).concat((config.plugins || {}).adapters || []);\n    adapters = adapters.map(Adapter => new Adapter());\n    primaryAdapterId = config.primaryAdapterId || new GregorianAdapter({ locale }).id;\n    primaryAdapter = getAdapter(primaryAdapterId);\n\n    generators = ([BasicGenerator]).concat((config.plugins || {}).generators || []);\n    generators = generators.map((Generator) => {\n      const dependencies = { Event, OneDate, getAdapter, primaryAdapterId };\n      return new Generator(dependencies, { locale });\n    });\n  };\n  construct();\n\n  const addEvent = (eventConfig) => {\n    const generator = getGenerator(eventConfig.generatorId);\n    const event = generator.generate(eventConfig);\n    eventStore = eventStore.concat([event]);\n    return eventStore;\n  };\n\n  const removeEvent = (eventId) => {\n    eventStore = eventStore.filter(evt => evt.id !== eventId);\n    return eventStore;\n  };\n\n  const editEvent = (eventConfig) => {\n    removeEvent(eventConfig.id);\n    return addEvent(eventConfig);\n  };\n\n  const handleOverlaps = (seriesArray, _since, _till) => seriesArray.reduce((sArray, series) => {\n    if (series.overlap.external.includes('allow')) return sArray.concat([series]);\n\n    const conflicts = sArray.filter((s) => {\n      const sameGenerator = s.generatorId === series.generatorId;\n      const sameOverlapRule = s.overlap.external === series.overlap.external;\n      return sameGenerator && sameOverlapRule;\n    }).concat([series])\n      .sort((a, b) => b.range.since.int() - a.range.since.int());\n    if (conflicts.length === 1) return sArray.concat([series]);\n\n    const master = conflicts[0];\n\n    const items = sArray.filter((s) => {\n      const sameGenerator = s.generatorId === series.generatorId;\n      const sameOverlapRule = s.overlap.external === series.overlap.external;\n      return !(sameGenerator && sameOverlapRule);\n    });\n\n    const forever = series.overlap.external.includes('forever');\n\n    const rangeSince = master.range.since;\n    const rangeTill = forever ? _till.offsetYear(1) : master.range.till;\n\n    if (series.overlap.external.includes('remove')) {\n      const slaves = conflicts.slice(1).reduce((sa, s) => {\n        const item = s;\n        item.events = s.events\n          .filter(e => !e.collides(rangeSince, rangeTill));\n        return sa.concat(item);\n      }, []);\n      return items.concat([master]).concat(slaves);\n    }\n    if (series.overlap.external.includes('trim')) {\n      const slaves = conflicts.slice(1).reduce((sa, s) => {\n        const item = s;\n        const slaveEvents = s.events\n          .filter(e => e.collides(rangeSince, rangeTill))\n          .sort((a, b) => b.since.int() - a.since.int());\n        if (!slaveEvents.length) return sa.concat(item);\n        const evts = s.events\n          .filter(e => !e.collides(rangeSince, rangeTill));\n        const trimmedSlaves = slaveEvents.map((evt) => {\n          let slave = evt;\n          let collision = slave.collides(rangeSince, rangeTill);\n          while (collision) {\n            if (collision.includes('r')) {\n              slave = (new Event({\n                id: slave.id,\n                generatorId: slave.generatorId,\n                virtual: slave.virtual,\n                repeated: slave.repeated,\n                overlap: slave.overlap,\n                priority: slave.priority,\n                title: slave.title,\n                note: slave.note,\n                color: slave.color,\n                since: slave.since,\n                till: rangeSince.offsetDay(-1),\n              })).query(_since, _till, 'event[]')[0];\n            } else if (collision.includes('l')) {\n              slave = (new Event({\n                id: slave.id,\n                generatorId: slave.generatorId,\n                virtual: slave.virtual,\n                repeated: slave.repeated,\n                overlap: slave.overlap,\n                priority: slave.priority,\n                title: slave.title,\n                note: slave.note,\n                color: slave.color,\n                since: rangeTill.offsetDay(1),\n                till: slave.till,\n              })).query(_since, _till, 'event[]')[0];\n            }\n            collision = slave ? slave.collides(rangeSince, rangeTill) : false;\n          }\n          return slave;\n        }).filter(evt => evt && evt.till.int() - evt.since.int() >= 0);\n        item.events = evts.concat(trimmedSlaves);\n        return sa.concat(item);\n      }, []);\n      return items.concat([master]).concat(slaves);\n    }\n    return sArray.concat([series]);\n  }, []);\n\n  const getEventsIn = (_since, _till) => {\n    const since = generateDate(_since);\n    const till = generateDate(_till);\n    const seriesArray = eventStore.reduce((acc, e) => {\n      let sa = acc;\n      const series = e.query(since, till);\n      if (!series.events.length) return sa;\n      sa = sa.concat([series]);\n      sa = handleOverlaps(sa, since, till);\n      return sa;\n    }, []);\n    let events = seriesArray.reduce((evts, s) => evts.concat(s.events), []);\n    events = events.sort((a, b) => a.since.int() - b.since.int());\n    return events;\n  };\n\n  return {\n    getAdaptersInfo,\n    getGeneratorsInfo,\n    generateDate,\n    getCurrentDate,\n    getMonthInfo,\n    addEvent,\n    getEventsIn,\n    editEvent,\n    removeEvent,\n  };\n};\n\nexports.EventManager = EventManager;\n"]}